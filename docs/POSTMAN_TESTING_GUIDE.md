# Postman API æµ‹è¯•æŒ‡å— ğŸ“‹

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨Postmanæµ‹è¯•Interactive Foresté¡¹ç›®çš„åç«¯APIã€‚

## ğŸš€ å‡†å¤‡å·¥ä½œ

### 1. å¯åŠ¨åç«¯æœåŠ¡

```powershell
cd apps/cv_service
$env:SAM_WEIGHTS="./app/models/sam_vit_h_4b8939.pth"
$env:OUTPUT_DIR="../../output"
python -m uvicorn app.main:app --reload --port 7001
```

### 2. éªŒè¯æœåŠ¡è¿è¡Œ

è®¿é—® <http://localhost:7001/docs> æŸ¥çœ‹APIæ–‡æ¡£

### 3. å¯¼å…¥Postmané›†åˆ

åˆ›å»ºæ–°çš„Postmané›†åˆï¼Œé…ç½®ä»¥ä¸‹åŸºç¡€è®¾ç½®ï¼š

- **Base URL**: `http://localhost:7001`
- **Content-Type**: `application/json`

## ğŸ“‹ APIç«¯ç‚¹æµ‹è¯•

### 1. å¥åº·æ£€æŸ¥æ¥å£

**GET** `/health`

**ç”¨é€”**: éªŒè¯æœåŠ¡çŠ¶æ€

**è¯·æ±‚ç¤ºä¾‹**:

```
GET http://localhost:7001/health
```

**é¢„æœŸå“åº”**:

```json
{
  "status": "healthy",
  "timestamp": "2024-01-XX XX:XX:XX"
}
```

**æµ‹è¯•éªŒè¯**:

- âœ… çŠ¶æ€ç : 200
- âœ… å“åº”åŒ…å« `status: "healthy"`

---

### 2. æ–‡ä»¶ä¸Šä¼ æ¥å£

**POST** `/upload-file`

**ç”¨é€”**: ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶å¹¶è·å–ä¼šè¯ID

**è¯·æ±‚é…ç½®**:

- æ–¹æ³•: POST
- Bodyç±»å‹: form-data
- å­—æ®µ: `file` (é€‰æ‹©å›¾ç‰‡æ–‡ä»¶)

**æµ‹è¯•æ­¥éª¤**:

1. åœ¨Bodyé€‰é¡¹å¡é€‰æ‹© `form-data`
2. æ·»åŠ key: `file`, type: `File`
3. é€‰æ‹©æµ‹è¯•å›¾ç‰‡ (å»ºè®®ä½¿ç”¨ `assets/datasets/test/drawing_0006.png`)

**é¢„æœŸå“åº”**:

```json
{
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ",
  "filename": "drawing_0006.png"
}
```

**æµ‹è¯•éªŒè¯**:

- âœ… çŠ¶æ€ç : 200
- âœ… è¿”å›æœ‰æ•ˆçš„session_id (UUIDæ ¼å¼)
- âœ… æ–‡ä»¶ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•

---

### 3. è·å–åŸå§‹å›¾ç‰‡

**GET** `/sessions/{session_id}/original`

**ç”¨é€”**: è·å–ä¸Šä¼ çš„åŸå§‹å›¾ç‰‡

**è·¯å¾„å‚æ•°**:

- `session_id`: ä»ä¸Šä¼ æ¥å£è·å¾—çš„ä¼šè¯ID

**è¯·æ±‚ç¤ºä¾‹**:

```
GET http://localhost:7001/sessions/550e8400-e29b-41d4-a716-446655440000/original
```

**é¢„æœŸå“åº”**:

- Content-Type: `image/png`
- å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®

**æµ‹è¯•éªŒè¯**:

- âœ… çŠ¶æ€ç : 200
- âœ… å“åº”ç±»å‹ä¸ºå›¾ç‰‡
- âœ… èƒ½æ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡å†…å®¹

---

### 4. SAMç¼–ç å™¨å¤„ç†

**POST** `/sessions/{session_id}/encode`

**ç”¨é€”**: ä½¿ç”¨SAMç¼–ç å™¨å¤„ç†å›¾ç‰‡

**è·¯å¾„å‚æ•°**:

- `session_id`: ä¼šè¯ID

**è¯·æ±‚ä½“**: ç©º (æ— éœ€body)

**è¯·æ±‚ç¤ºä¾‹**:

```
POST http://localhost:7001/sessions/550e8400-e29b-41d4-a716-446655440000/encode
```

**é¢„æœŸå“åº”**:

```json
{
  "message": "ç¼–ç å®Œæˆ",
  "session_id": "550e8400-e29b-41d4-a716-446655440000",
  "encoding_time": 2.45
}
```

**æµ‹è¯•éªŒè¯**:

- âœ… çŠ¶æ€ç : 200
- âœ… ç¼–ç æ—¶é—´ < 10ç§’
- âœ… è¿”å›ç›¸åŒçš„session_id

---

### 5. æ¡†é€‰åˆ†å‰²

**POST** `/sessions/{session_id}/segment-box`

**ç”¨é€”**: é€šè¿‡çŸ©å½¢æ¡†é€‰è¿›è¡Œå›¾åƒåˆ†å‰²

**è·¯å¾„å‚æ•°**:

- `session_id`: ä¼šè¯ID

**è¯·æ±‚ä½“**:

```json
{
  "input_box": [100, 100, 300, 250]
}
```

**å­—æ®µè¯´æ˜**:

- `input_box`: çŸ©å½¢æ¡†åæ ‡ [x1, y1, x2, y2]
- åæ ‡ç³»: å·¦ä¸Šè§’ä¸ºåŸç‚¹ (0,0)

**è¯·æ±‚ç¤ºä¾‹**:

```
POST http://localhost:7001/sessions/550e8400-e29b-41d4-a716-446655440000/segment-box
Content-Type: application/json

{
  "input_box": [100, 100, 300, 250]
}
```

**é¢„æœŸå“åº”**:

```json
{
  "masks": [
    {
      "mask_id": 0,
      "score": 0.95,
      "area": 15234
    },
    {
      "mask_id": 1,
      "score": 0.88,
      "area": 12456
    }
  ],
  "segment_time": 0.15
}
```

**æµ‹è¯•éªŒè¯**:

- âœ… çŠ¶æ€ç : 200
- âœ… è¿”å›å¤šä¸ªå€™é€‰æ©ç 
- âœ… æ©ç æŒ‰åˆ†æ•°æ’åº (é«˜åˆ°ä½)
- âœ… åˆ†å‰²æ—¶é—´ < 1ç§’

---

### 6. ç‚¹å‡»åˆ†å‰²

**POST** `/sessions/{session_id}/segment-point`

**ç”¨é€”**: é€šè¿‡ç‚¹å‡»è¿›è¡Œå›¾åƒåˆ†å‰²

**è¯·æ±‚ä½“**:

```json
{
  "input_point": [200, 150],
  "input_label": 1
}
```

**å­—æ®µè¯´æ˜**:

- `input_point`: ç‚¹å‡»åæ ‡ [x, y]
- `input_label`: 1=å‰æ™¯ç‚¹, 0=èƒŒæ™¯ç‚¹

**æµ‹è¯•ç”¨ä¾‹**:

**ç”¨ä¾‹1: å‰æ™¯ç‚¹**

```json
{
  "input_point": [200, 150],
  "input_label": 1
}
```

**ç”¨ä¾‹2: èƒŒæ™¯ç‚¹**

```json
{
  "input_point": [50, 50],
  "input_label": 0
}
```

**é¢„æœŸå“åº”**: åŒæ¡†é€‰åˆ†å‰²æ¥å£

---

### 7. å¤šç‚¹åˆ†å‰²

**POST** `/sessions/{session_id}/segment-points`

**ç”¨é€”**: é€šè¿‡å¤šä¸ªç‚¹è¿›è¡Œç²¾ç¡®åˆ†å‰²

**è¯·æ±‚ä½“**:

```json
{
  "input_points": [[200, 150], [250, 180], [180, 200]],
  "input_labels": [1, 1, 1]
}
```

**é«˜çº§æµ‹è¯•ç”¨ä¾‹**:

```json
{
  "input_points": [[200, 150], [250, 180], [50, 50], [400, 50]],
  "input_labels": [1, 1, 0, 0]
}
```

**é¢„æœŸå“åº”**: åŒæ¡†é€‰åˆ†å‰²æ¥å£

---

### 8. è·å–æ©ç å›¾ç‰‡

**GET** `/sessions/{session_id}/mask/{mask_id}`

**ç”¨é€”**: è·å–æŒ‡å®šæ©ç çš„å¯è§†åŒ–å›¾ç‰‡

**è·¯å¾„å‚æ•°**:

- `session_id`: ä¼šè¯ID
- `mask_id`: æ©ç ID (ä»åˆ†å‰²æ¥å£è·å¾—)

**è¯·æ±‚ç¤ºä¾‹**:

```
GET http://localhost:7001/sessions/550e8400-e29b-41d4-a716-446655440000/mask/0
```

**é¢„æœŸå“åº”**:

- Content-Type: `image/png`
- é»‘ç™½æ©ç å›¾ç‰‡ (ç™½è‰²=é€‰ä¸­åŒºåŸŸ, é»‘è‰²=èƒŒæ™¯)

---

### 9. å¯¼å‡ºROI (æŠ å›¾ç»“æœ)

**GET** `/sessions/{session_id}/export-roi/{mask_id}`

**ç”¨é€”**: å¯¼å‡ºé€æ˜èƒŒæ™¯çš„PNGæŠ å›¾ç»“æœ

**è¯·æ±‚ç¤ºä¾‹**:

```
GET http://localhost:7001/sessions/550e8400-e29b-41d4-a716-446655440000/export-roi/0
```

**é¢„æœŸå“åº”**:

- Content-Type: `image/png`
- é€æ˜èƒŒæ™¯PNGå›¾ç‰‡
- åªåŒ…å«é€‰ä¸­åŒºåŸŸçš„å†…å®¹

**æµ‹è¯•éªŒè¯**:

- âœ… çŠ¶æ€ç : 200
- âœ… å›¾ç‰‡æ ¼å¼ä¸ºPNG
- âœ… èƒŒæ™¯é€æ˜
- âœ… å‰æ™¯æ¸…æ™°å®Œæ•´

---

### 10. Base64å¯¼å‡º

**GET** `/sessions/{session_id}/export-roi-b64/{mask_id}`

**ç”¨é€”**: è·å–Base64ç¼–ç çš„æŠ å›¾ç»“æœ

**é¢„æœŸå“åº”**:

```json
{
  "image_b64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA...",
  "mask_id": 0,
  "format": "png"
}
```

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æ ‡å‡†å·¥ä½œæµæµ‹è¯•

1. **å¥åº·æ£€æŸ¥**

   ```
   GET /health
   ```

2. **ä¸Šä¼ æ–‡ä»¶**

   ```
   POST /upload-file
   (è·å–session_id)
   ```

3. **ç¼–ç å¤„ç†**

   ```
   POST /sessions/{session_id}/encode
   ```

4. **åˆ†å‰²æµ‹è¯•**

   ```
   POST /sessions/{session_id}/segment-box
   (è·å–maskåˆ—è¡¨)
   ```

5. **ç»“æœéªŒè¯**

   ```
   GET /sessions/{session_id}/mask/0
   GET /sessions/{session_id}/export-roi/0
   ```

### è¾¹ç•Œæ¡ä»¶æµ‹è¯•

**æ— æ•ˆä¼šè¯ID**:

```
GET /sessions/invalid-uuid/original
é¢„æœŸ: 404 Not Found
```

**æ— æ•ˆæ©ç ID**:

```
GET /sessions/{valid_session_id}/mask/999
é¢„æœŸ: 404 Not Found
```

**ç©ºæ–‡ä»¶ä¸Šä¼ **:

```
POST /upload-file
(ä¸é€‰æ‹©æ–‡ä»¶)
é¢„æœŸ: 422 Unprocessable Entity
```

**æœªç¼–ç ç›´æ¥åˆ†å‰²**:

```
POST /sessions/{session_id}/segment-box
(è·³è¿‡encodeæ­¥éª¤)
é¢„æœŸ: 400 Bad Request
```

## ğŸ“Š æ€§èƒ½åŸºå‡†

### é¢„æœŸå“åº”æ—¶é—´

- æ–‡ä»¶ä¸Šä¼ : < 1ç§’
- SAMç¼–ç : 3-8ç§’ (é¦–æ¬¡è¾ƒæ…¢)
- å›¾åƒåˆ†å‰²: < 500ms
- å›¾ç‰‡è·å–: < 200ms

### å†…å­˜ä½¿ç”¨

- ç©ºé—²çŠ¶æ€: ~2GB
- å¤„ç†1080på›¾ç‰‡: ~4GB
- å¤šä¼šè¯å¹¶å‘: æ¯ä¼šè¯+1GB

## ğŸ”§ Postmané…ç½®

### ç¯å¢ƒå˜é‡è®¾ç½®

```javascript
// åœ¨Testsæ ‡ç­¾ä¸­æ·»åŠ è‡ªåŠ¨åŒ–è„šæœ¬
if (pm.response.code === 200) {
    var jsonData = pm.response.json();
    if (jsonData.session_id) {
        pm.environment.set("session_id", jsonData.session_id);
    }
}
```

### é›†åˆå˜é‡

- `base_url`: `http://localhost:7001`
- `session_id`: åŠ¨æ€è·å–
- `mask_id`: åŠ¨æ€è·å–

### é¢„è¯·æ±‚è„šæœ¬

```javascript
// æ£€æŸ¥å¿…éœ€çš„ç¯å¢ƒå˜é‡
if (!pm.environment.get("session_id")) {
    console.log("Warning: session_id not set, please run upload-file first");
}
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. è¿æ¥è¢«æ‹’ç»

**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨
**è§£å†³**: æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼Œé‡å¯æœåŠ¡

### 2. ç¼–ç è¶…æ—¶

**åŸå› **: SAMæ¨¡å‹åŠ è½½æ—¶é—´é•¿
**è§£å†³**: è®¾ç½®æ›´é•¿çš„è¯·æ±‚è¶…æ—¶æ—¶é—´ (30ç§’)

### 3. å†…å­˜ä¸è¶³

**åŸå› **: å›¾ç‰‡è¿‡å¤§æˆ–å¹¶å‘è¿‡å¤š
**è§£å†³**: å‹ç¼©å›¾ç‰‡æˆ–å‡å°‘å¹¶å‘æ•°

### 4. æ©ç è´¨é‡å·®

**åŸå› **: è¾“å…¥ç‚¹/æ¡†ä¸å‡†ç¡®
**è§£å†³**: è°ƒæ•´è¾“å…¥åæ ‡ï¼Œå°è¯•å¤šç§ç»„åˆ

## ğŸ“ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰APIç«¯ç‚¹æ­£å¸¸å“åº”
- [ ] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
- [ ] SAMç¼–ç å®Œæˆ
- [ ] åˆ†å‰²ç»“æœè´¨é‡è‰¯å¥½
- [ ] å›¾ç‰‡å¯¼å‡ºæ­£ç¡®
- [ ] é”™è¯¯å¤„ç†æ°å½“
- [ ] æ€§èƒ½æ»¡è¶³è¦æ±‚
- [ ] å†…å­˜ä½¿ç”¨æ­£å¸¸

---

**ç¥æµ‹è¯•æ„‰å¿«ï¼å¦‚æœ‰é—®é¢˜è¯·æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚** ğŸ¯
