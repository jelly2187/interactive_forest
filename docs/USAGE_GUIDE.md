# Interactive Forest - 使用指南

## 🎯 项目概述

Interactive Forest 是一个专业的双屏互动森林系统，支持图像分割、元素控制和投影展示。

## 🏗️ 系统架构

### 双屏设计

- **控制台** (`/`): SAM图像分割工作流和元素管理
- **投影屏幕** (`/projection`): 森林背景视频和元素展示

### 技术栈

- **前端**: React + TypeScript + Vite
- **桌面**: Electron
- **渲染**: Canvas 2D + PIXI.js支持
- **后端**: SAM服务 (localhost:7001)

## 🚀 启动应用

### 1. 启动SAM后端服务

```bash
cd apps/cv_service
python -m uvicorn app.main:app --reload --port 7001
```

### 2. 启动桌面应用

```bash
cd apps/desktop
npm run dev
```

## 📋 使用流程

### 阶段1: 图像分割工作流

1. **上传图像** 📁
   - 点击"选择图片"按钮
   - 支持常见图像格式 (PNG, JPG, etc.)

2. **ROI区域选择** 📦
   - 在画布上拖拽创建ROI框
   - 支持多个ROI区域
   - 可以删除、编辑ROI标签

3. **分割标注** ✂️
   - 左键: 添加正向点 ✅
   - 右键: 添加负向点 ❌
   - 使用"优化画笔"减少冗余点
   - 支持撤销操作

4. **候选选择** 🎯
   - 查看多个分割候选结果
   - 选择最佳分割方案
   - 查看置信度和边界框信息

5. **确认添加** ✅
   - 将选定元素添加到舞台
   - 自动发送到投影屏幕

### 阶段2: 元素控制管理

6. **音效配置** 🎵
   - 选择预设音频文件
   - 调节音量 (0-100%)
   - 设置循环播放
   - 实时预览功能

7. **轨迹编辑** 📍
   - 可视化轨迹编辑器
   - 点击画布添加关键帧
   - 设置动画时长
   - 调整缩放、旋转、透明度
   - 实时动画预览

8. **显示控制** 👁️
   - 单个元素显示/隐藏
   - 全局显示/隐藏控制
   - 实时同步到投影屏幕

## 🎭 投影屏幕功能

### 森林背景

- **视频播放**: 自动加载 `forest.mp4`
- **备用支持**: 自动尝试 `forest1.mp4`
- **静态背景**: 视频加载失败时的备用方案

### 交互效果

- **鼠标跟随**: 涟漪、火花、叶子效果
- **点击效果**: 多层次视觉反馈
- **环境粒子**: 持续的森林氛围效果

### 性能监控

- FPS显示
- 元素数量统计
- 视频状态监控
- 鼠标位置追踪

## 🔧 快捷键和技巧

### 控制台快捷操作

- **ROI选择**: 直接在画布拖拽
- **点标注**: 左键正向，右键负向
- **轨迹编辑**: 点击画布添加关键帧
- **批量操作**: 全部显示/隐藏

### 工作流优化

1. **批量ROI**: 先标记所有ROI区域，再逐个处理
2. **点优化**: 使用"优化画笔"减少处理时间
3. **预览确认**: 分割前使用预览检查结果
4. **轨迹规划**: 先设计路径，再调整参数

## 🛠️ 故障排除

### 常见问题

**1. SAM服务连接失败**

- 检查后端服务是否在localhost:7001运行
- 确认防火墙设置
- 查看服务器状态指示器

**2. 图像分割效果不佳**

- 增加更多正向/负向标注点
- 尝试不同的ROI区域大小
- 检查图像质量和对比度

**3. 视频播放问题**

- 确认 `public/video/forest.mp4` 文件存在
- 检查视频格式兼容性
- 查看浏览器控制台错误信息

**4. 元素同步问题**

- 确保控制台和投影屏幕都已打开
- 检查postMessage通信
- 重新启动应用

### 性能优化

- **大图像**: 建议压缩到合适尺寸
- **多元素**: 限制同时显示的元素数量
- **复杂轨迹**: 减少关键帧密度

## 📁 项目结构

```
apps/
├── desktop/                 # Electron桌面应用
│   ├── electron/           # Electron主进程
│   └── renderer/           # React渲染进程
│       ├── src/
│       │   ├── pages/      # 页面组件
│       │   │   ├── ControlPanel.tsx     # 控制台
│       │   │   └── ProjectionScreen.tsx # 投影屏幕
│       │   ├── components/ # UI组件
│       │   │   ├── AudioControlModal.tsx
│       │   │   └── TrajectoryEditorModal.tsx
│       │   └── services/   # API服务
│       └── public/         # 静态资源
│           ├── video/      # 背景视频
│           └── audio/      # 音效文件
└── cv_service/             # SAM后端服务
```

## 🎯 下一步开发

### 功能扩展

- [ ] 更多音效和视频素材
- [ ] 高级轨迹插值算法
- [ ] 元素物理碰撞检测
- [ ] 场景保存和加载
- [ ] 多用户协作支持

### 性能优化

- [ ] WebGL渲染支持
- [ ] 图像分割缓存
- [ ] 流式视频处理
- [ ] 内存管理优化

---

🌲 **Interactive Forest** - 让创意在数字森林中绽放！
