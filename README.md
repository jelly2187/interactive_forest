# Interactive Forest - 儿童画作互动森林 🌲

这是一个创新的互动艺术项目，将儿童的画作转化为生动的森林生态系统。

## ✨ 核心功能

### 🎨 智能抠图系统

- **AI驱动**: 使用SAM (Segment Anything Model) 进行精确的图像分割
- **交互式编辑**: 支持点击、框选、画笔微调等多种抠图方式
- **实时预览**: 即时查看分割效果，支持多候选掩码选择

### 🌲 沉浸式森林舞台

- **视频背景**: 高质量循环播放的动物森林场景
- **全屏体验**: 无边框全屏模式，打造沉浸式体验
- **元素叠加**: 抠图元素实时叠加到森林背景上

### 🎭 动画与交互系统

- **多种动画效果**:
  - 🍃 摇摆动画 (sway): 温和的左右摇摆
  - ✈️ 飞行动画 (fly): 波浪式飞行轨迹
  - 🚶 路径移动 (move): 自定义路径移动
- **拖拽控制**: 鼠标自由拖拽元素位置
- **触碰反馈**: 点击元素触发音效和动画

### 🎵 音效系统

- **元素专属音效**: 每个元素分配独特的声音
- **触发播放**: 点击或选中时播放音效
- **环境音**: 可选的背景环境音效

## 🚀 快速开始

### 1. 启动后端服务

```powershell
cd apps/cv_service

# 设置环境变量
$env:SAM_WEIGHTS="./app/models/sam_vit_h_4b8939.pth"
$env:OUTPUT_DIR="../../output"

# 启动SAM服务
python -m uvicorn app.main:app --reload --port 7001
```

### 2. 启动前端应用

```powershell
cd apps/desktop
npm install
npm run dev
```

### 3. 准备媒体资源

请将以下文件放置到指定位置：

**视频背景** (必需):

- 📁 `apps/desktop/renderer/public/video/forest.mp4`
- 推荐规格: 1920x1080, MP4格式, 循环动画

**音效文件** (可选):

- 📁 `apps/desktop/renderer/public/audio/`
  - `bird.mp3` - 鸟类音效
  - `dog.mp3` - 动物音效  
  - `wind.mp3` - 风声音效

## 🎯 使用流程

### 编辑器模式 (Editor)

1. **上传画作**: 选择儿童画作文件或输入图片路径
2. **框选区域**: 在画作上拖拽框选要抠图的区域
3. **精细调整**: 通过点击添加前景/背景点进行精确控制
4. **选择结果**: 从AI生成的多个候选结果中选择最佳效果
5. **导出元素**: 导出透明背景的PNG精灵图

### 森林舞台模式 (Stage)

1. **进入舞台**: 点击"森林舞台"标签进入展示模式
2. **沉浸体验**: 点击"进入沉浸模式"开启全屏显示
3. **元素交互**:
   - 🖱️ **拖拽移动**: 鼠标拖拽改变元素位置
   - 🔊 **音效触发**: 点击元素播放专属音效
   - 🎬 **动画观赏**: 观看元素的自动动画效果

## 🛠️ 技术架构

### 后端 (FastAPI + SAM)

- **图像分割**: Meta SAM模型提供AI抠图能力
- **会话管理**: 支持多用户同时使用
- **文件管理**: 自动处理上传、处理、导出流程

### 前端 (Electron + React + PIXI.js)

- **跨平台**: Electron提供桌面应用体验
- **现代UI**: React构建响应式用户界面
- **高性能渲染**: PIXI.js实现流畅的2D图形和动画

### 核心特性

- 🔄 **实时同步**: 前后端实时通信
- 🎨 **GPU加速**: 硬件加速的图形渲染
- 📱 **响应式**: 适配不同分辨率屏幕
- 🔊 **多媒体**: 视频、音频、图像综合处理

## 🎪 应用场景

### 教育展示

- **儿童美术展**: 将静态画作转化为动态展示
- **互动教学**: 让孩子看到自己的创作"活"起来
- **艺术治疗**: 通过互动增强孩子的创作兴趣

### 商业应用

- **艺术画廊**: 创新的数字艺术展示方式
- **儿童乐园**: 沉浸式的娱乐体验
- **教育机构**: 现代化的教学工具

## 🔧 自定义配置

### 动画参数调整

在Stage组件中可以调整动画参数：

```typescript
animation: {
  type: 'sway',      // 动画类型
  speed: 1.0,        // 速度倍数
  amplitude: 10,     // 摇摆幅度
  phase: 0           // 初始相位
}
```

### 音效配置

```typescript
sound: {
  audio: HTMLAudioElement,
  loop: true,        // 是否循环
  volume: 0.3        // 音量 (0.0-1.0)
}
```

## 📋 系统要求

### 硬件要求

- **CPU**: 支持AVX指令集 (Intel i5或同等性能)
- **内存**: 16GB+ RAM (SAM模型较大)
- **显卡**: 支持WebGL 2.0 (集成显卡即可)
- **存储**: 5GB+ 可用空间

### 软件环境

- **操作系统**: Windows 10/11, macOS 10.15+, Linux
- **Node.js**: 16.0+
- **Python**: 3.8+
- **浏览器**: Chrome 80+, Firefox 75+, Safari 13+

## 🚨 故障排除

### 常见问题

**1. 黑屏问题**

- 确保已安装React类型定义: `npm install @types/react @types/react-dom`
- 检查视频文件是否存在于正确路径

**2. SAM服务连接失败**

- 验证后端服务运行状态: `http://localhost:7001/health`
- 检查环境变量设置是否正确

**3. 音效无法播放**

- 确保音频文件格式正确 (MP3, WAV)
- 检查浏览器自动播放策略设置

### 调试技巧

- 开启DevTools查看控制台错误
- 使用网络面板监控API请求
- 查看终端输出的详细日志

## 🤝 贡献指南

欢迎贡献代码、报告问题或提出改进建议！

1. Fork 项目仓库
2. 创建特性分支: `git checkout -b feature/amazing-feature`
3. 提交更改: `git commit -m 'Add amazing feature'`
4. 推送分支: `git push origin feature/amazing-feature`
5. 创建Pull Request

## 📄 开源协议

本项目采用 MIT 协议 - 详见 [LICENSE](LICENSE) 文件

## 🎉 致谢

- **Meta AI** - SAM (Segment Anything Model) 提供强大的图像分割能力
- **PIXI.js** - 高性能2D渲染引擎
- **React & Electron** - 现代化的前端技术栈
- **FastAPI** - 高性能Python Web框架

---

**让每一幅儿童画作都在数字森林中绽放生命力！** 🌟
